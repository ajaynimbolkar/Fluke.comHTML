/* jshint devel:true */var windowHeight,windowWidth,desktopTrigger=768,headerSite,navSite,navControl,navClose,headerStuck=!1,contentSection,contentSectionPadding,contentGradient,btn,stickyFooter,footerStuck=!1,currentBottom,toolWindow,toolFrame,toolCategories,toolOverlay,storyWindow,storyLink,storyOverlay,storyClose,videoWindow,videoLink,videoOverlay,videoClose,targetUrl,stickyPhone,phoneStuck=!1,panelCount,panelWidth,panelCurrent=0,snapping=!1,adjust,ie8=!1;jQuery.noConflict();(function(e){function t(){if(footerStuck){currentBottom=e(window).height()+e(window).scrollTop()-stickyFooter.height();currentBottom>=stickyFooter.parent(".stuck-wrapper").offset().top&&windowWidth>=desktopTrigger?stickyFooter.removeClass("fixed"):stickyFooter.addClass("fixed")}if(phoneStuck){currentBottom=e(window).height()+e(window).scrollTop()-stickyPhone.height()-70;currentBottom>=stickyPhone.parent(".stuck-wrapper").offset().top&&windowWidth>=desktopTrigger?stickyPhone.removeClass("fixed"):stickyPhone.addClass("fixed")}}function n(){var t=e(window).scrollTop();contentSection.each(function(n){var r=e(this).offset().top-10,i="header.site a[href*=#"+e(this).attr("name")+"]";i.indexOf("why-fluke-connect")!==-1&&(i="header.site a[href*=#why-fluke-connect]");if(t>=r){navSite.find("a").removeClass("active");e(i).addClass("active");n>=1&&e(".screen-window").css({backgroundPosition:"-"+(n-1)*171+"px 0"});var s=e(this);setTimeout(function(){s.find(".anim").addClass("active")},500)}})}function r(){windowWidth<desktopTrigger&&videoOverlay.hide()}function i(){videoLink.click(function(e){if(windowWidth>=desktopTrigger){e.preventDefault();videoOverlay.fadeIn("fast",function(){})}});videoClose.click(function(){videoOverlay.fadeOut("fast")})}function s(){storyLink.click(function(t){if(windowWidth>=desktopTrigger){t.preventDefault();targetUrl=e(this).attr("href");storyOverlay.fadeIn("fast",function(){e.get(targetUrl).done(function(t){var n=e(t).find("section .wrapper").html();storyWindow.html(n);windowWidth>1100&&windowHeight>600?storyWindow.css({marginTop:storyWindow.height()/2+"px"}):storyWindow.css({marginTop:"100px"})})})}});storyClose.click(function(){storyOverlay.fadeOut("fast",function(){storyWindow.html("")})})}function o(){toolCategories.addClass("js");var t=toolCategories.find("ul"),n=t.find("li"),r=n.find("a"),i=n.length,s=0,o=n.width(),f=toolCategories.find(".next"),l=toolCategories.find(".prev"),c=n.find("p"),h=0;c.each(function(){e(this).height()>h&&(h=e(this).height());e(this).height(h)});t.width(i*o);f.click(function(n){n.preventDefault();if(!e(this).hasClass("disabled")){s++;if(s<i){l.removeClass("disabled");t.animate({marginLeft:"-"+s*o+"px"},function(){var e=windowWidth<500?2:6;s===i-e&&f.addClass("disabled")})}}});l.click(function(n){n.preventDefault();if(!e(this).hasClass("disabled")){s--;if(s>=0){f.removeClass("disabled");t.animate({marginLeft:"-"+s*o+"px"},function(){s===0&&l.addClass("disabled")})}}});r.click(function(t){if(windowWidth>=desktopTrigger){t.preventDefault();n.removeClass("active");e(this).parent().addClass("active");e(".next-prev").show();targetUrl=e(this).attr("href");toolOverlay.animate({opacity:1},"fast",function(){e.get(targetUrl).done(function(t){panelCurrent=0;e(".next-prev .previous").addClass("disabled");toolFrame.css({marginLeft:0});var n=e(t).find("section .wrapper").html();toolFrame.html(n);a();e(".next-prev").show();toolOverlay.animate({opacity:0},"fast");u()})})}})}function u(){var t=toolFrame.find(".panel"),n=e(".tool-wrapper").find(".breadcrumb");n.html("");t.each(function(t){var r=e(this).data("name"),i=t===0?"active":"";n.append('<li class="'+i+'">'+r+"</li>")});e(".tool-wrapper .breadcrumb li").each(function(t){e(this).on("click",function(n){n.preventDefault();panelCurrent=t;toolFrame.css({marginLeft:"-"+panelCurrent*panelWidth+"px"});e(".tool-wrapper .breadcrumb li").removeClass("active").eq(t).addClass("active");panelCurrent===0?e(".next-prev").find(".previous").addClass("disabled"):e(".next-prev").find(".previous").removeClass("disabled");panelCurrent===panelCount-1?e(".next-prev").find(".next").addClass("disabled"):e(".next-prev").find(".next").removeClass("disabled")})})}function a(){panelCount=toolFrame.find(".panel").length;panelWidth=toolFrame.find(".panel").width();panelCount<=1?e(".next-prev span").addClass("disabled"):e(".next-prev .next").removeClass("disabled");var t=panelCount*panelWidth;toolFrame.width(t)}function f(){panelWidth=toolFrame.find(".panel").width();if(windowWidth>=desktopTrigger){var t=e(".next-prev"),n=t.find(".next"),r=t.find(".previous");n.click(function(t){t.preventDefault();if(panelCurrent+1<=panelCount-1){panelCurrent++;toolFrame.css({marginLeft:"-"+panelCurrent*panelWidth+"px"});r.removeClass("disabled");e(".tool-wrapper .breadcrumb li").removeClass("active").eq(panelCurrent).addClass("active");panelCurrent===panelCount-1&&e(this).addClass("disabled")}});r.click(function(t){t.preventDefault();if(panelCurrent-1>=0){panelCurrent--;toolFrame.css({marginLeft:"-"+panelCurrent*panelWidth+"px"});n.removeClass("disabled");e(".tool-wrapper .breadcrumb li").removeClass("active").eq(panelCurrent).addClass("active");panelCurrent===0&&e(this).addClass("disabled")}})}}function l(){if(toolFrame.width!==panelCount*panelWidth){toolFrame.width(panelCount*panelWidth).css({marginLeft:0});panelCurrent=0;a()}}function c(){headerSite.sticky({wrapperClassName:"stuck-header"});headerStuck=!0}function h(){stickyFooter.wrap('<div class="stuck-wrapper" style="height:'+stickyFooter.height()+'px;"></div>');stickyPhone.wrap('<div class="stuck-wrapper" style="height:'+stickyPhone.height()+'px;"></div>');if(windowWidth>desktopTrigger){stickyFooter.addClass("fixed");footerStuck=!0;stickyPhone.addClass("fixed");phoneStuck=!0}else{stickyFooter.removeClass("fixed");footerStuck=!1;stickyPhone.removeClass("fixed");phoneStuck=!1}t()}function p(){windowWidth<desktopTrigger?btn.parent().addClass("text-center"):btn.parent().removeClass("text-center")}function d(){if(windowWidth<desktopTrigger+15)navSite.height(windowHeight);else{navSite.height("auto");navSite.removeClass("active")}navControl.click(function(){navSite.addClass("active")});navClose.click(function(){navSite.removeClass("active")})}function v(){if(windowWidth<1100)contentGradient.css({minHeight:"auto"});else{adjust=0;contentGradient.parent().attr("id")==="stories"&&(adjust=55);contentGradient.css({minHeight:windowHeight+"px"})}contentGradient.each(function(){e(this).parent().attr("id")==="stories"&&e(this).css({minHeight:windowHeight-120+"px"})})}e(function(){if(e("body").hasClass("ie8")){ie8=!0;e("#stories nav li:nth-child(2)").addClass("child-2");e("#stories nav li:nth-child(3)").addClass("child-3");e("footer.site .stuck nav li:last-child").addClass("last-child")}windowHeight=e(window).height();windowWidth=e(window).width();headerSite=e("header.site");navSite=e("header.site nav");navControl=headerSite.find(".control");navClose=headerSite.find(".close");contentSection=e(".content section");contentGradient=contentSection.find(".gradient");contentGradient.length>0&&(contentSectionPadding=contentGradient.eq(0).css("padding-top").replace(/px/,""));btn=e(".btn");stickyFooter=e("footer.site .stuck");toolWindow=e(".tool-window");toolOverlay=toolWindow.find(".overlay");toolFrame=toolWindow.find(".frame");toolCategories=e("nav.categories");storyLink=e("nav.stories a");storyOverlay=e(".story-overlay");storyWindow=storyOverlay.find(".story-frame");storyClose=e(".story-close");videoLink=e("a.video");videoOverlay=e(".video-overlay");videoWindow=videoOverlay.find(".video-embed");videoClose=e(".video-close");stickyPhone=e(".sticky-phone");e("a").each(function(){var t=new RegExp("/"+window.location.host+"/");t.test(this.href)||e(this).click(function(e){e.preventDefault();e.stopPropagation();window.open(this.href,"_blank")})});e("body").addClass("js");if(windowWidth>desktopTrigger&&snapping===!1&&ie8===!1){e(".front").snapscroll({axis:"y",botPadding:0,topPadding:0});snapping=!0}e.localScroll({easing:"easeInOutQuart",offset:{top:windowWidth<=desktopTrigger?-60:0},onBefore:function(){navClose.click()}});toolOverlay.swipe({swipe:function(t,n){n==="right"&&e(".next-prev .previous").click();n==="left"&&e(".next-prev .next").click()}});d();v();p();c();h();o();s();i();f();e(window).resize(function(){windowHeight=e(window).height();windowWidth=e(window).width();d();v();r();f();p();l();if(windowWidth>desktopTrigger&&snapping===!1&&ie8===!1){e(".front").snapscroll({axis:"y"});snapping=!0}});e(window).scroll(function(){t();n()})})})(jQuery);